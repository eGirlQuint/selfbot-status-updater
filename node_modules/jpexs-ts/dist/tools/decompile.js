'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.decompile = void 0;
var fs = require('fs');
var path = require('path');
var spawn = require('child_process').spawn;
var buildParameters = function (options) {
    var params = ['-jar', path.resolve(__dirname, '../../bin/ffdec.jar')];
    if (options.selectClass && options.selectClass.length) {
        params.push('-selectclass');
        params.push(options.selectClass.join(','));
    }
    if (options.formats && options.formats.length) {
        params.push('-format');
        params.push(options.formats.join(','));
    }
    if (options.items && options.items.length) {
        params.push('-export');
        params.push(options.items.join(','));
    }
    params.push(options.output);
    params.push(options.file);
    return params;
};
var decompile = function (options, callbacks) {
    if (!options) {
        callbacks.onError('No options provided');
        return;
    }
    if (!fs.existsSync(options.file)) {
        callbacks.onError('File not found');
        return;
    }
    var javaProccess = spawn('java', buildParameters(options));
    javaProccess.stdout.on('data', function (data) { return callbacks.onStdout(data.toString('utf8')); });
    javaProccess.stderr.on('data', function (data) { return callbacks.onError(data.toString('utf8')); });
    javaProccess.on('close', function () { return callbacks.onClose(); });
    javaProccess.on('error', function (error) {
        if (error.message.includes('ENOENT')) {
            callbacks.onError('Java Development Kit not found. Please install it.');
        }
    });
};
exports.decompile = decompile;
