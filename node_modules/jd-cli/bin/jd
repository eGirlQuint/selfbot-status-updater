#!/usr/bin/env node

var path = require('path')
var program = require('commander')
var yellow = require('chalk').yellow
var {
  mkfile,
  jsTemplate,
  jadeTemplate,
  scssTemplate,
  pageTemplate
} = require(`${__dirname}/../util`)

program.version(require('../package').version)
process.env.NODE_PATH = __dirname + '/../node_modules/'

function component(arg) {
  var widget = 'widget/' + arg
  mkfile(widget, {
    maps: [
      jsTemplate(widget),
      jadeTemplate(widget),
      scssTemplate(widget)
    ],
    callback: function (err) {
      if (err) return console.log(err)
      process.stderr.write(yellow('widget文件创建完成\n'))
    }
  })

  var page = 'page/' + path.dirname(arg)
  mkfile(page, {
    maps: [
      pageTemplate(arg)
    ],
    callback: function (err) {
      if (err) return console.log(err)
      process.stderr.write(yellow('page文件创建完成\n'))
    }
  })
}

program
  .usage('[options] [value ...]')
  .option('-v, --version', 'output the version number', () => {
    console.log(program.version())
  })
  .option('-c, --message <string>', 'create component in project', component)

program.parse(process.argv)